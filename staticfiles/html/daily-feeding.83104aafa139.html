{% extends "digitaldairy/html/common-header.html" %}
{% block title %} Daily Feeding {% endblock %}
{% block content %}
{% load mathfilters %}
<section>
    <div class="text-right sf-html-block">
        <button type="button" class="btn btn-primary" data-toggle="modal"
            data-target="#dailyFeedingInputModal">
            <span>
                &plus; Daily Feeding
            </span>
        </button>
    </div>
    <div class="modal" id="dailyFeedingInputModal" tabindex="-1"
        aria-labelledby="dailyFeedingInputModalLabel" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title text-center" id="dailyFeedingInputModalLabel">
                        Add Daily Feeding Record
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="dailyFeedingInputForm" method="post" action="{% url 'digitaldairy:save_daily_feeding' %}">
                        <div class="form-group">
                            <label for="feeding_date" class="col-form-label">
                                Date
                            </label>
                            <input id="feeding_date" class="form-control" type="date" name="feeding_date" required>
                        </div>
                        <div class="form-group">
                            <label for="feed_formulation" class="col-form-label">
                                Select Feed Formulation
                            </label>
                            <select id="feed_formulation"  class="form-control" name="feed_formulation" required>
                                <option value="Select Feed Formulation" disabled selected="selected">Select Feed Formulation</option>
                                {% if feed_formulations_list %}
                                {% for feed_formulation in feed_formulations_list %}
                                <option value="{{feed_formulation.id}}" name="feed_formulation">{{feed_formulation.name}} ({{ feed_formulation.quantity }})</option>
                                {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="feeding_category" class="col-form-label">
                                Feeding Group
                            </label>
                            <select id="feeding_category"  class="form-control"
                                name="feeding_category" required>
                                <option value="" disabled selected="selected">Select Group</option>
                                <option value="Milker">Milker</option>
                                <option value="Dry">Dry</option>
                                <option value="Steamer">Steamer</option>
                                <option value="Heifer">Heifer</option>
                                <option value="Incalf-Heifer">Incalf Heifer</option>
                                <option value="Calf">Calf</option>
                                <option value="Weaner-1">Weaner 1</option>
                                <option value="Weaner-2">Weaner 2</option>
                                <option value="Weaner-3">Weaner 3</option>
                                <option value="Bull">Bull</option>
                                <option value="Bulling-Calf">Bulling Calf</option>
                                <option value="Yearling">Yearling</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="feed_formulation_quantity" class="col-form-label">
                                Quantity
                            </label>
                            <input id="feed_formulation_quantity" class="form-control" type="number" name="feed_formulation_quantity" min="0">
                        </div>
                        {% csrf_token %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button form="dailyFeedingInputForm" type="submit" class="btn btn-primary">Save
                        Record</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <h4 class="text-center">
                        Daily Feeding List
                    </h4>
                    <table class="table table-hover">
                        <thead class="text-center">
                            <tr>
                                <th> # </th>
                                <th> Date </th>
                                <th> Items in Feed Formulation </th>
                                <th> Item Quantity </th>
                                <th> Feeding Group </th>
                                <th> Actions </th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            {% if daily_feeding_list %}
                            {% for daily_feeding in daily_feeding_list %}
                            <tr>
                                <td> {{ forloop.counter }} </td>
                                <td> {{ daily_feeding.date }} </td>
                                <td>
                                {% with daily_feeding.feed_formulation.feedformulationpart_set.all as feed_formulation_item_list %}
                                    {% for feed_item_part in feed_formulation_item_list %}
                                    {{ feed_item_part.feed_item.name }} ({{feed_item_part.quantity}}),
                                    {% endfor %}
                                {% endwith %}
                                </td>
                                <td> {{daily_feeding.quantity}} </td>
                                <td> {{daily_feeding.feeding_category}} </td>
                                <td>
                                    <button type="button" data-toggle="modal"
                                        data-target="#dailyFeedingInputModal" class='btn btn-sm btn-primary' aria-label="Edit">
                                        <span class="fa fa-edit"></span>
                                    </button>
                                    <form id="deleteDailyFeedingForm" method="post"
                                          action="{% url 'digitaldairy:delete_daily_feeding' %}">
                                        <input name="daily_feeding_id" type="hidden" value="{{daily_feeding.id}}">
                                        {% csrf_token %}
                                        <button form="deleteDailyFeedingForm" type="submit"
                                                class='btn btn-sm btn-danger' aria-label="Delete">
                                            <span class="fa fa-times"></span>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}